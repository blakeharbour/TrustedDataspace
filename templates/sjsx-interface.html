<!-- _meta 作为公共模版分离出去 -->
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="stylesheet" type="text/css" href="/static/static/h-ui/css/H-ui.min.css" />
  <link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/css/h-ui.admin.pro.min.css" />
  <link rel="stylesheet" type="text/css" href="/static/lib/Hui-iconfont/1.0.8/iconfont.css" />
  <link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/skin/default/skin.css" id="skin" />
  <link rel="stylesheet" type="text/css" href="/static/static/business/css/style.css" />
  <title>可信数据空间</title>
</head>
<body>
<!-- _menu -->
<aside class="Hui-admin-aside-wrapper">
  <div class="Hui-admin-logo-wrapper">
    <a class="logo navbar-logo" href="/aboutHui.shtml">
      <i class="va-m iconpic global-logo"></i>
      <span class="va-m">可信数据空间</span>
    </a>
  </div>
  <div class="Hui-admin-menu-dropdown bk_2">
    <dl class="Hui-menu">
      <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 用户管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
      <dd class="Hui-menu-item" style="display:block">
        <ul>
          <li><a href="http://127.0.0.1:8000/user-list/" title="用户管理">用户管理</a></li>
        </ul>
      </dd>
    </dl>
    <dl class="Hui-menu">
      <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 模型训练管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
      <dd class="Hui-menu-item" style="display:block">
        <ul>
          <li><a href="http://127.0.0.1:8000/model-list/" title="模型列表">模型列表</a></li>
          <li><a href="http://127.0.0.1:8000/sample-alignment/" title="样本对齐情况">样本对齐情况</a></li>
          <li><a href="http://127.0.0.1:8000/train-model/" title="模型训练结果查看">模型训练结果查看</a></li>
        </ul>
      </dd>
    </dl>
    <dl class="Hui-menu">
      <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 模型应用<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
      <dd class="Hui-menu-item" style="display:block">
        <ul>
          <li><a href="http://127.0.0.1:8000/application_model-main/" title="模型使用">模型使用</a></li>
          <li><a href="http://127.0.0.1:8000/application_result/" title="模型应用结果">模型应用结果</a></li>
        </ul>
      </dd>
    </dl>
    <dl class="Hui-menu">
      <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 数据安全共享方法<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
      <dd class="Hui-menu-item" style="display:block">
        <ul>
          <li><a href="http://127.0.0.1:8000/wb-interface/" title="数据接口">数据接口</a></li>
          <li><a href="http://127.0.0.1:8000/sjsx-interface/" title="数据沙箱">数据沙箱</a></li>
          <li><a href="http://127.0.0.1:8000/index/" title="隐私计算">隐私计算</a></li>
          <li><a href="http://127.0.0.1:8000/mutiindex/" title="密文计算">密文计算</a></li>
        </ul>
      </dd>
    </dl>
  </div>
</aside>

<!-- 主体内容 -->
<div class="Hui-admin-dislpayArrow">
  <a href="javascript:void(0);" onClick="displaynavbar(this)">
    <i class="Hui-iconfont Hui-iconfont-left">&#xe6d4;</i>
    <i class="Hui-iconfont Hui-iconfont-right">&#xe6d7;</i>
  </a>
</div>

<section class="Hui-admin-article-wrapper">
  <header class="Hui-navbar">
    <div class="navbar">
      <div class="container-fluid clearfix">
        <nav class="nav navbar-nav"></nav>
        <nav class="nav navbar-nav navbar-userbar">
          <ul class="clearfix">
            <li class="dropDown dropDown_hover">
              <a href="#" class="dropDown_A">admin <i class="Hui-iconfont">&#xe6d5;</i></a>
              <ul class="dropDown-menu menu radius box-shadow">
                <li><a href="javascript:;" onClick="myselfinfo()">个人信息</a></li>
                <li><a href="#">切换账户</a></li>
                <li><a href="#">退出</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <div class="Hui-admin-article">
    <nav class="breadcrumb" style="background-color:#fff;padding: 0 24px">
      首页 <span class="c-gray en">/</span> 数据共享方法 <span class="c-gray en">/</span> 数据沙箱交互
    </nav>

    <article class="Hui-admin-content clearfix">
      <div class="alert alert-info mt-10 radius">
        当前操作基于可信数据空间技术，支持多因子认证、安全传输协议（TLS）、模型封装（Docker）、哈希校验（SHA-256）、自动销毁等标准机制，确保数据在使用全过程中的隐私与合规。
      </div>

      <div class="panel mt-20">
        <div class="panel-body">
          <div class="clearfix">
            <span class="f-l">
              <a href="javascript:;" onclick="uploadDataFeature()" class="btn btn-success radius" style="margin-right: 20px;">
                <i class="Hui-iconfont">&#xe645;</i> 上传新增沙箱
              </a>
              <a href="javascript:;" onclick="interface_add()" class="btn btn-primary radius" style="margin-right: 20px;">
                <i class="Hui-iconfont">&#xe600;</i> 新增数据接口
              </a>
              <a href="javascript:;" onclick="downloadSelected()" class="btn btn-primary radius">
                调用数据接口
              </a>
              <span class="label label-success radius">TLS/HTTPS 安全通道已启用</span>
            </span>
          </div>

          <div class="clearfix mt-20">
            <table class="table table-border table-bordered table-hover table-bg table-sort">
              <thead>
                <tr class="text-c">
                  <th width="30">选择</th>
                  <th>沙箱创建人</th>
                  <th>创建时间</th>
                  <th>数据访问路径</th>
                  <th>所存资产项名称</th>
                  <th>沙箱有效期</th>
                  <th>加密算法说明</th>
                  <th>访问授权范围</th>
                  <th>沙箱销毁策略</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="info">
                <!-- JS 渲染填充数据 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </article>
  </div>
</section>

<!-- JS 脚本 -->
<script type="text/javascript" src="/static/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/lib/layer/2.4/layer.js"></script>
<script type="text/javascript">
     // 在全局作用域定义变量
        let selectedInterface = {
            url: null,
            filename: null
        };

        // 全局变量存储用户信息
        var currentUser = {
            id: "{{ current_user.id }}",
            account: "{{ current_user.account }}",
        };

    
   $(function() {
    console.log("当前用户ID:", currentUser.id);
    console.log("当前用户名:", currentUser.account);

    $.ajax({
        type: "post",
        url: "http://127.0.0.1:8000/searchinsbsxterface/",
        dataType: 'json',
        success: function(res) {
            console.log("收到后端返回：", res);
            console.log("info 标签数量：", $("#info").length);

            if (res.status === 0) {
                const Result = res.data;
                console.log("解析数据：", Result);

                let str = '';
                for (let j = 0; j < Result.length; j++) {
                    const item = Result[j];  // 提升可读性
                    str += `
                        <tr class="text-c">
                          <td><input type="radio" name="selected_interface" data-path="${item[2]}"></td>
                          <td>${item[0]}</td>
                          <td>${item[1]}</td>
                          <td>${item[2]}</td>
                          <td>${item[3]}</td>
                          <td>${item[4]}</td>
                          <td>${item[5]}</td>
                          <td>${item[6]}</td>
                          <td>${item[7]}</td>
                          <td>
                            <a title="编辑" onclick="interface_edit(this,'${item[0]}')">
                              <i class="Hui-iconfont">&#xe6df;</i>编辑
                            </a>
                            <a title="删除" onclick="interface_dele(this,'${item[0]}')">
                              <i class="Hui-iconfont">&#xe6e2;</i>删除
                            </a>
                          </td>
                        </tr>`;
                }

                // 替换表格内容，确保不会叠加重复
                $("#info").html(str);
            } else {
                console.warn("后端返回非成功状态，status =", res.status);
                layer.msg("数据加载失败：" + res.msg, {icon: 2});
            }
        },
        error: function(err) {
            console.error("Ajax 请求失败：", err);
            layer.msg("请求失败，请检查接口是否可访问", {icon: 2});
        }
    });
});


function uploadDataFeature() {
  location.href = "http://127.0.0.1:8000/sjtzadd/";
}

function interface_add() {
  layer.msg("新增数据接口功能未实现", {icon: 0});
}

function downloadSelected() {
  layer.msg("调用数据接口中...", {icon: 1});
}

function destroyData(id) {
  layer.confirm('是否销毁该数据沙箱？此操作不可恢复', function(index){
    layer.msg("已销毁", {icon: 1});
  });
}
/*
$(function() {
  const data = [{
    creator: "李四",
    created_at: "2025-03-27 16:00",
    path: "/sandbox/data/asset202503",
    asset_name: "车务调度信息",
    expire: "2025-07-01",
    encryption: "国密 SM4 + 签名 SM2",
    scope: "铁路运输调度平台",
    destroy_policy: "使用后立即销毁"
  }];

  let html = data.map(item => `
    <tr class="text-c">
      <td><input type="checkbox" name="select"></td>
      <td>${item.creator}</td>
      <td>${item.created_at}</td>
      <td>${item.path}</td>
      <td>${item.asset_name}</td>
      <td>${item.expire}</td>
      <td>${item.encryption}</td>
      <td>${item.scope}</td>
      <td>${item.destroy_policy}</td>
      <td><a href="javascript:;" onclick="destroyData(1)">销毁</a></td>
    </tr>
  `).join("");

  $("#info").html(html);
});

*/
     
</script>
</body>
</html>
