<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>审核数据确权</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="favicon.ico" >
	<link rel="Shortcut Icon" href="favicon.ico" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="/static/lib/html5.js"></script>
	<script type="text/javascript" src="/static/lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/css/h-ui.admin.pro.min.css" />
	<link rel="stylesheet" type="text/css" href="/static/lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="/static/static/business/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->

	<meta name="keywords" content="h-ui.admin.pro v1.0,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
	<meta name="description" content="h-ui.admin.pro v1.0，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>
<body>
 <style>
    #menu-guest .Hui-menu-title,
    #menu-guest .Hui-menu-item a {
        color: #FFFFFF !important;  /* 亮白色 */
        text-shadow: 0 1px 2px rgba(0,0,0,0.2); /* 增加文字对比度 */
    }

    #menu-data-confirmation .Hui-menu-title,
    #menu-data-confirmation .Hui-menu-item a {
        color: #FFFFFF !important;  /* 亮白色 */
        text-shadow: 0 1px 2px rgba(0,0,0,0.2); /* 增加文字对比度 */
    }

    /* 修复搜索区域标签和输入框间距过大的问题 */
    .search-form .form-label {
        padding-right: 8px !important; /* 减小右边距 */
        text-align: right !important;
        line-height: 34px !important; /* 与输入框高度对齐 */
    }

    .search-form .formControls {
        padding-left: 0 !important; /* 减小左边距 */
    }

    .search-form .row.cl {
        margin-bottom: 10px !important; /* 减小行间距 */
    }
    </style>
<!-- 在<body>标签内的顶部添加 -->
{% if messages %}
<script>
    {% for message in messages %}
        alert("{{ message }}");
    {% endfor %}
</script>
{% endif %}
	<aside class="Hui-admin-aside-wrapper">
		<div class="Hui-admin-logo-wrapper">
			<a class="logo navbar-logo" href="/aboutHui.shtml">
				<i class="va-m iconpic global-logo"></i>
				<span class="va-m">可信数据空间</span>
			</a>
		</div>
		<div class="Hui-admin-menu-dropdown bk_2">
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 用户管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li ><a href="/user-list/" title="用户管理">用户管理</a></li>
					</ul>
				</dd>
			</dl>
            <dl id="menu-data-confirmation" class="Hui-menu">
              <dt class="Hui-menu-title"><i class="Hui-iconfont">&#xe616;</i> 数据确权<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
              <dd class="Hui-menu-item" style="display:block">
                <ul>
                  <li><a href="/data-confirmation/" title="数据确权">数据确权</a></li>
                </ul>
              </dd>
            </dl>

            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 数据资产管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li class="current"><a href="/data_asset_list/" title="数据资产列表">数据资产列表</a></li>
					</ul>
				</dd>

			</dl>
             <dl id="menu-guest" class="Hui-menu">
                <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 项目信息管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
                <dd class="Hui-menu-item" style="display:block">
                    <ul>
                        <li><a href="/established_project/" title="已建立项目">已建立项目</a></li>
                    </ul>
                    <ul>
                        <li><a href="/pengding_project/" title="待接受项目">待接受项目</a></li>
                    </ul>
                </dd>
            </dl>
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 区块链存证信息管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/records/" title="数据存证信息">数据存证信息</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/project_notarization/" title="项目存证信息">项目存证信息</a></li>
					</ul>
				</dd>
			</dl>
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i>数据安全共享方法<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/wb-interface/" title="数据接口">数据接口</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/sjsx-interface/" title="数据沙箱">数据沙箱</a></li>
					</ul>
				</dd>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/guest-list/" title="隐私计算">隐私计算</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/multguest-list/" title="密文计算">密文计算</a></li>
					</ul>
				</dd>
			</dl>
		</div>
	</aside>
    <div class="Hui-admin-aside-mask"></div>

	<div class="Hui-admin-dislpayArrow">
		<a href="javascript:void(0);" onClick="displaynavbar(this)">
			<i class="Hui-iconfont Hui-iconfont-left">&#xe6d4;</i>
			<i class="Hui-iconfont Hui-iconfont-right">&#xe6d7;</i>
		</a>
	</div>
	<section class="Hui-admin-article-wrapper">
		<!--_header 作为公共模版分离出去-->
		<header class="Hui-navbar">
			<div class="navbar">
				<div class="container-fluid clearfix">
          <nav id="Hui-topNav" class="nav navbar-nav">
            <ul class="clearfix">
              {% comment %}<li><a href="">顶部菜单</a></li>{% endcomment %}
              <li class="dropDown dropDown_hover">
                {% comment %}<a class="dropDown_A" href="javascript:;">顶部菜单</a>{% endcomment %}
                <ul class="dropDown-menu menu radius box-shadow">
                  <li class="">
                    <a href="#">二级导航</a>
                  </li>
                  <li class="">
                    <a href="#">二级导航</a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
					<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar">
						<ul class="clearfix">
							{% comment %}<li>超级管理员</li>{% endcomment %}

</ul>
					</nav>
				</div>
			</div>
		</header>
		<!--/_header 作为公共模版分离出去-->
        <!-- 以下是审核数据确权列表页面内容 -->

		<div class="Hui-admin-article">
			<nav class="breadcrumb" style="background-color:#fff;padding: 0 24px">
                首页
                <span class="c-gray en">/</span>
                数据确权
                <span class="c-gray en">/</span>
                <a href="{% url 'data_confirmation_list' %}">数据确权记录</a>
                <span class="c-gray en">/</span>
                审核数据确权
            </nav>

			<div class="pd-20">
				<!-- 页面标题和操作按钮 -->
				<div class="text-c mb-20">
					<div class="f-l">
						<h2 class="h2-title">审核数据确权</h2>
					</div>
					<div class="f-r">
						<a href="{% url 'data_confirmation_list' %}" class="btn btn-default">
							<i class="Hui-iconfont">&#xe6d4;</i> 返回主页
						</a>
					</div>
					<div class="cl"></div>
				</div>



				<!-- 搜索和过滤区域 -->
				<div class="text-c mb-20">
					<form method="get" class="Hui-form text-l search-form">
						<div class="row cl">
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label class="form-label col-xs-4 col-sm-3">数据名称：</label>
								<div class="formControls col-xs-8 col-sm-9">
									<input type="text" class="input-text" name="search" value="{{ search_query }}" placeholder="请输入数据名称">
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label class="form-label col-xs-4 col-sm-3">申请状态：</label>
								<div class="formControls col-xs-8 col-sm-9">
									<span class="select-box">
										<select class="select" name="status">
											<option value="">全部状态</option>
											{% for status_code, status_name in application_status_choices %}
												<option value="{{ status_code }}" {% if status_filter == status_code %}selected{% endif %}>{{ status_name }}</option>
											{% endfor %}
										</select>
									</span>
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<label class="form-label col-xs-4 col-sm-3">申请方：</label>
								<div class="formControls col-xs-8 col-sm-9">
									<span class="select-box">
										<select class="select" name="applicant">
											<option value="">全部机构</option>
											{% for source_code, source_name in data_source_choices %}
												<option value="{{ source_code }}" {% if applicant_filter == source_code %}selected{% endif %}>{{ source_name }}</option>
											{% endfor %}
										</select>
									</span>
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-3">
								<div class="formControls">
									<button type="submit" class="btn btn-primary">搜索</button>
									<a href="{% url 'data_right_application_list' %}" class="btn btn-default ml-10">重置</a>
								</div>
							</div>
						</div>
					</form>
				</div>

				<!-- 申请列表 -->
				<div class="mt-20">
					{% if page_obj %}
						{% for application in page_obj %}
							<div class="application-card mb-15" onclick="goToReview('{{ application.application_id }}')">
								<div class="pd-20 bg-1 radius-5 border-solid-1 border-color-ddd cursor-pointer hover-bg-light">
									<div class="row cl">
										<div class="col-xs-12 col-sm-8">
											<div class="application-header mb-10">
												<h4 class="text-primary mb-5">{{ application.target_data_name }}</h4>
												<div class="application-meta">
													<span class="application-id">申请编号：{{ application.application_id }}</span>
												</div>
											</div>
											<div class="c-666 mb-5">
												<span class="mr-20"><strong>申请方：</strong>{{ application.get_applicant_display }}</span>
												<span class="mr-20"><strong>数据持有方：</strong>{{ application.get_target_data_holder_display }}</span>
												<span class="mr-20"><strong>申请时间：</strong>{{ application.created_at|date:"Y-m-d H:i" }}</span>
											</div>
											<div class="c-666 mb-5">
												<strong>申请权利：</strong>{{ application.get_applied_rights_display }}
											</div>
											<div class="c-666 mb-5">
												<strong>业务环节：</strong>{{ application.get_target_business_stage_display }}
											</div>
											<div class="c-666">
												<strong>联系人：</strong>{{ application.contact_person }} | {{ application.contact_phone }}
											</div>
										</div>
										<div class="col-xs-12 col-sm-4 text-r">
											<div class="mt-10 mb-10">
												{% if application.status == 'pending' %}
													<span class="label label-warning">待审核</span>
												{% elif application.status == 'approved' %}
													<span class="label label-success">已同意</span>
												{% elif application.status == 'rejected' %}
													<span class="label label-danger">已拒绝</span>
												{% elif application.status == 'withdrawn' %}
													<span class="label label-default">已撤回</span>
												{% endif %}
											</div>
											{% if application.status == 'pending' %}
												<div class="mb-10">
													<small class="c-orange">
														<i class="Hui-iconfont">&#xe6df;</i> 待处理
													</small>
												</div>
												<div>
													<button type="button" class="btn btn-success btn-sm mr-5" onclick="quickReview('{{ application.application_id }}', 'approve', event)">
														<i class="Hui-iconfont">&#xe6df;</i> 快速通过
													</button>
													<button type="button" class="btn btn-danger btn-sm" onclick="quickReview('{{ application.application_id }}', 'reject', event)">
														<i class="Hui-iconfont">&#xe6de;</i> 快速拒绝
													</button>
												</div>
											{% else %}
												<div class="mb-10">
													{% if application.reviewer %}
														<small class="c-666">审核人：{{ application.reviewer }}</small>
													{% endif %}
												</div>
												<div>
													{% if application.review_time %}
														<small class="c-999">{{ application.review_time|date:"Y-m-d H:i" }}</small>
													{% endif %}
												</div>
											{% endif %}
											<div class="mt-10">
												<small class="c-999">点击查看详情</small>
											</div>
										</div>
									</div>
								</div>
							</div>
						{% endfor %}

						<!-- 分页 -->
						<div class="text-c mt-30">
							<div class="pagination">
								{% if page_obj.has_previous %}
									<a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if applicant_filter %}&applicant={{ applicant_filter }}{% endif %}" class="btn btn-default">首页</a>
									<a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if applicant_filter %}&applicant={{ applicant_filter }}{% endif %}" class="btn btn-default">上一页</a>
								{% endif %}

								<span class="btn btn-primary">第 {{ page_obj.number }} 页 / 共 {{ page_obj.paginator.num_pages }} 页</span>

								{% if page_obj.has_next %}
									<a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if applicant_filter %}&applicant={{ applicant_filter }}{% endif %}" class="btn btn-default">下一页</a>
									<a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}{% if applicant_filter %}&applicant={{ applicant_filter }}{% endif %}" class="btn btn-default">末页</a>
								{% endif %}
							</div>
							<div class="mt-10">
								<small class="c-666">共 {{ page_obj.paginator.count }} 条申请记录</small>
							</div>
						</div>
					{% else %}
						<div class="text-c mt-50">
							<div class="empty-data">
								<i class="Hui-iconfont" style="font-size:48px;color:#ccc;">&#xe6df;</i>
								<p class="mt-10 c-999">暂无待审核的申请</p>
								<div class="mt-20">
									<small class="c-666">当前没有需要审核的数据确权申请</small>
								</div>
							</div>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
</section>

<!-- 快速审核弹窗 -->
<div id="quickReviewModal" class="modal fade" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">快速审核</h4>
				<button type="button" class="close" onclick="closeModal()">&times;</button>
			</div>
			<div class="modal-body">
				<form id="quickReviewForm">
					<div class="form-group">
						<label>审核意见：</label>
						<textarea id="quickReviewComments" class="form-control" rows="3" placeholder="请输入审核意见" required></textarea>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" onclick="closeModal()">取消</button>
				<button type="button" class="btn btn-primary" onclick="submitQuickReview()">确认</button>
			</div>
		</div>
	</div>
</div>

<!-- JavaScript 和 CSS 样式 -->
<style>
	.h2-title {
		color: #333;
		font-weight: 500;
		margin: 0;
	}



	.application-card {
		transition: all 0.3s ease;
	}

	.application-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	}

	.hover-bg-light:hover {
		background-color: #f8f9fa !important;
	}

	.cursor-pointer {
		cursor: pointer;
	}

	.border-color-ddd {
		border-color: #ddd;
	}

	.application-header {
		border-bottom: 1px solid #eee;
		padding-bottom: 8px;
	}

	.application-id {
		font-size: 12px;
		color: #999;
		background-color: #f8f9fa;
		padding: 2px 6px;
		border-radius: 3px;
	}

	.application-meta {
		margin-top: 5px;
	}

	.label {
		padding: 4px 8px;
		font-size: 12px;
		border-radius: 3px;
	}

	.label-success {
		background-color: #5cb85c;
		color: white;
	}

	.label-warning {
		background-color: #f0ad4e;
		color: white;
	}

	.label-danger {
		background-color: #d9534f;
		color: white;
	}

	.label-default {
		background-color: #999;
		color: white;
	}

	.btn-sm {
		padding: 4px 8px;
		font-size: 12px;
	}

	.c-orange {
		color: #f0ad4e;
	}

	.empty-data {
		padding: 40px 20px;
	}

	.pagination {
		display: inline-block;
	}

	.pagination a, .pagination span {
		margin: 0 2px;
	}

	/* 模态框样式 */
	.modal {
		display: none;
		position: fixed;
		z-index: 1000;
		left: 0;
		top: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0,0,0,0.5);
	}

	.modal.show {
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.modal-dialog {
		background-color: white;
		border-radius: 8px;
		width: 90%;
		max-width: 500px;
	}

	.modal-header {
		padding: 15px;
		border-bottom: 1px solid #eee;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.modal-body {
		padding: 15px;
	}

	.modal-footer {
		padding: 15px;
		border-top: 1px solid #eee;
		text-align: right;
	}

	.form-control {
		width: 100%;
		padding: 8px;
		border: 1px solid #ddd;
		border-radius: 4px;
	}

	.close {
		background: none;
		border: none;
		font-size: 24px;
		cursor: pointer;
	}

	@media (max-width: 768px) {
		.btn-sm {
			margin-bottom: 5px;
		}

		/* 移动端搜索表单优化 */
		.search-form .form-label {
			padding-right: 5px !important;
		}

		.search-form .col-xs-12 {
			margin-bottom: 8px !important;
		}
	}
</style>

<script type="text/javascript" src="/static/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/static/h-ui/js/H-ui.js"></script>
<script type="text/javascript" src="/static/static/h-ui.admin.pro/js/h-ui.admin.pro.min.js"></script>

<script type="text/javascript">
	let currentApplicationId = '';
	let currentAction = '';

	// 跳转到审核详情页面
	function goToReview(applicationId) {
		window.location.href = "{% url 'data_right_application_review' 'APPLICATION_ID' %}".replace('APPLICATION_ID', applicationId);
	}

	// 快速审核
	function quickReview(applicationId, action, event) {
		event.stopPropagation(); // 阻止事件冒泡

		currentApplicationId = applicationId;
		currentAction = action;

		const modalTitle = action === 'approve' ? '快速通过' : '快速拒绝';
		$('#quickReviewModal .modal-title').text(modalTitle);

		const placeholder = action === 'approve' ? '请输入通过理由和注意事项' : '请输入拒绝原因';
		$('#quickReviewComments').attr('placeholder', placeholder);

		showModal();
	}

	// 显示模态框
	function showModal() {
		$('#quickReviewModal').addClass('show');
		$('#quickReviewComments').focus();
	}

	// 关闭模态框
	function closeModal() {
		$('#quickReviewModal').removeClass('show');
		$('#quickReviewComments').val('');
		currentApplicationId = '';
		currentAction = '';
	}

	// 提交快速审核
	function submitQuickReview() {
		const comments = $('#quickReviewComments').val().trim();
		if (!comments) {
			alert('请输入审核意见');
			return;
		}

		// 这里应该发送AJAX请求到后端
		$.ajax({
			url: "{% url 'data_right_application_review' 'APPLICATION_ID' %}".replace('APPLICATION_ID', currentApplicationId),
			method: 'POST',
			data: {
				'review_decision': currentAction,
				'review_comments': comments,
				'csrfmiddlewaretoken': $('[name=csrfmiddlewaretoken]').val()
			},
			success: function(response) {
				alert(currentAction === 'approve' ? '审核通过成功' : '审核拒绝成功');
				location.reload();
			},
			error: function() {
				alert('操作失败，请重试');
			}
		});

		closeModal();
	}

	// 页面加载完成后的初始化
	$(document).ready(function(){
		// 初始化下拉选择框
		if(typeof $.Huifold != 'undefined') {
			$.Huifold();
		}

		// 高亮当前菜单项 - 数据确权页面
            $('#menu-data-confirmation').addClass('selected');
            $('#menu-data-confirmation .Hui-menu-item a[href*="data-confirmation"]').parent().addClass('current');

            // 确保其他菜单项不被高亮
            $('#menu-guest').removeClass('selected');
            $('#menu-guest .Hui-menu-item li').removeClass('current');

		// 模态框点击外部关闭
		$('#quickReviewModal').click(function(e) {
			if (e.target === this) {
				closeModal();
			}
		});

		// ESC键关闭模态框
		$(document).keyup(function(e) {
			if (e.keyCode === 27) {
				closeModal();
			}
		});
	});

	// 导航栏显示隐藏
	function displaynavbar(obj){
		if($(".Hui-admin-aside-wrapper").hasClass("aside-hide")){
			$(".Hui-admin-aside-wrapper").removeClass("aside-hide");
			$(obj).find("i").removeClass("Hui-iconfont-right").addClass("Hui-iconfont-left");
		} else {
			$(".Hui-admin-aside-wrapper").addClass("aside-hide");
			$(obj).find("i").removeClass("Hui-iconfont-left").addClass("Hui-iconfont-right");
		}
	}
</script>
</body>
</html>