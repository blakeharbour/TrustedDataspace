<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据资产列表</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="favicon.ico" >
	<link rel="Shortcut Icon" href="favicon.ico" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="/static/lib/html5.js"></script>
	<script type="text/javascript" src="/static/lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/css/h-ui.admin.pro.min.css" />
	<link rel="stylesheet" type="text/css" href="/static/lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="/static/static/h-ui.admin.pro/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="/static/static/business/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->

	<meta name="keywords" content="h-ui.admin.pro v1.0,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
	<meta name="description" content="h-ui.admin.pro v1.0，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>
<body>
 <style>
    #menu-guest .Hui-menu-title,
    #menu-guest .Hui-menu-item a {
        color: #FFFFFF !important;  /* 亮白色 */
        text-shadow: 0 1px 2px rgba(0,0,0,0.2); /* 增加文字对比度 */
    }

    #menu-data-confirmation .Hui-menu-title,
    #menu-data-confirmation .Hui-menu-item a {
        color: #FFFFFF !important;  /* 亮白色 */
        text-shadow: 0 1px 2px rgba(0,0,0,0.2); /* 增加文字对比度 */
    }
    </style>
<!-- 在<body>标签内的顶部添加 -->
{% if messages %}
<script>
    {% for message in messages %}
        alert("{{ message }}");
    {% endfor %}
</script>
{% endif %}
	<aside class="Hui-admin-aside-wrapper">
		<div class="Hui-admin-logo-wrapper">
			<a class="logo navbar-logo" href="/aboutHui.shtml">
				<i class="va-m iconpic global-logo"></i>
				<span class="va-m">可信数据空间</span>
			</a>
		</div>
		<div class="Hui-admin-menu-dropdown bk_2">
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 用户管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li ><a href="/user-list/" title="用户管理">用户管理</a></li>
					</ul>
				</dd>
			</dl>
            <dl id="menu-data-confirmation" class="Hui-menu">
              <dt class="Hui-menu-title"><i class="Hui-iconfont">&#xe616;</i> 数据确权<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
              <dd class="Hui-menu-item" style="display:block">
                <ul>
                  <li><a href="/data-confirmation/" title="数据确权">数据确权</a></li>
                </ul>
              </dd>
            </dl>

            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 数据管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li class="current"><a href="/data_asset_list/" title="数据列表">数据列表</a></li>
					</ul>
				</dd>

			</dl>
             <dl id="menu-guest" class="Hui-menu">
                <dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 项目信息管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
                <dd class="Hui-menu-item" style="display:block">
                    <ul>
                        <li><a href="/established_project/" title="已建立项目">已建立项目</a></li>
                    </ul>
                    <ul>
                        <li><a href="/pengding_project/" title="待接受项目">待接受项目</a></li>
                    </ul>
                </dd>
            </dl>
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i> 存证信息管理<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/records/" title="数据存证信息">数据存证信息</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/project_notarization/" title="项目存证信息">项目存证信息</a></li>
					</ul>
				</dd>
			</dl>
            <dl id="menu-guest" class="Hui-menu">
				<dt class="Hui-menu-title selected"><i class="Hui-iconfont">&#xe60d;</i>数据安全共享方法<i class="Hui-iconfont Hui-admin-menu-dropdown-arrow">&#xe6d5;</i></dt>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/wb-interface/" title="数据接口">数据接口</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/sjsx-interface/" title="数据沙箱">数据沙箱</a></li>
					</ul>
				</dd>
				<dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/guest-list/" title="隐私计算">隐私计算</a></li>
					</ul>
				</dd>
                <dd class="Hui-menu-item" style="display:block">
					<ul>
						<li><a href="/multguest-list/" title="密文计算">密文计算</a></li>
					</ul>
				</dd>
			</dl>
		</div>
	</aside>
    <div class="Hui-admin-aside-mask"></div>

	<div class="Hui-admin-dislpayArrow">
		<a href="javascript:void(0);" onClick="displaynavbar(this)">
			<i class="Hui-iconfont Hui-iconfont-left">&#xe6d4;</i>
			<i class="Hui-iconfont Hui-iconfont-right">&#xe6d7;</i>
		</a>
	</div>
	<section class="Hui-admin-article-wrapper">
		<!--_header 作为公共模版分离出去-->
		<header class="Hui-navbar">
			<div class="navbar">
				<div class="container-fluid clearfix">
          <nav id="Hui-topNav" class="nav navbar-nav">
            <ul class="clearfix">
              {% comment %}<li><a href="">顶部菜单</a></li>{% endcomment %}
              <li class="dropDown dropDown_hover">
                {% comment %}<a class="dropDown_A" href="javascript:;">顶部菜单</a>{% endcomment %}
                <ul class="dropDown-menu menu radius box-shadow">
                  <li class="">
                    <a href="#">二级导航</a>
                  </li>
                  <li class="">
                    <a href="#">二级导航</a>
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
					<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar">
						<ul class="clearfix">
							{% comment %}<li>超级管理员</li>{% endcomment %}

</ul>
					</nav>
				</div>
			</div>
		</header>
		<!--/_header 作为公共模版分离出去-->
		<div class="Hui-admin-article">
			<nav class="breadcrumb" style="background-color:#fff;padding: 0 24px">
				首页
				<span class="c-gray en">/</span>
				数据管理
				<span class="c-gray en">/</span>
				数据列表

			</nav>

<article class="Hui-admin-content clearfix">
<div class="panel-body">

                        <!-- 显示消息 -->
                        {% if messages %}
                            <div class="alert">
                                {% for message in messages %}
                                    <div class="alert-{{ message.tags }}">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}</div>
  <div class="panel mt-20">
					<div class="panel-body"发布>
                    <div class="clearfix">
							<span class="f-l">
                                <a href="javascript:;" onclick="add_dataasset()" class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加数据资产</a>
                                <a href="javascript:;" onclick="batch_delete()" class="btn btn-danger radius">
    <i class="Hui-iconfont">&#xe6e2;</i> 批量删除
</a>
								{% comment %}<a href="javascript:;" onclick="datadel()" class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a>{% endcomment %}
							</span>
							{% comment %}<span class="f-r">共有数据：<strong>3</strong> 条</span>{% endcomment %}
						</div>

						<div class="clearfix mt-20">
{% csrf_token %}
        <table class="table table-border table-bordered table-hover table-bg table-sort">
          <thead>
            <tr>
              <th width="25"></th>
              <th width="80">ID</th>
              <th width="80">名称</th>
              <th width="90">所有者</th>
              <th width="80">描述</th>
              <th width="80">格式</th>
              <th width="100">安全等级</th>
{#              <th width="80">状态</th>#}
{#              <th width="100">访问路径</th>#}
              <th width="50">操作</th>
            </tr>
          </thead>
          <tbody>
{#            {% for asset in data_assets %}#}
{#              <tr>#}
{#                <td><input type="checkbox" value="{{ asset.assetID }}" name="selected_assets"></td>#}
{#                <td>{{ asset.assetID }}</td>#}
{#                <td>{{ asset.assetName }}</td>#}
{#                <td>{{ asset.assetOwner }}</td>#}
{#                <td>{{ asset.description }}</td>#}
{#                <td>{{ asset.assetFormat }}</td>#}
{#                <td>{{ asset.get_assetLevel_display }}</td>#}
{#                <td>{{ asset.get_status_display }}</td>#}
{#                <td>#}
{#                  {% if asset.status == 'started' %}#}
{#                    {{ asset.assetPath }}#}
{#                  {% else %}#}
{#                    未开始#}
{#                  {% endif %}#}
{#                </td>#}
{#                <td>#}
{#                  <a href="javascript:;" onclick="edit_dataasset('{{ asset.assetID }}')" class="btn btn-primary radius">#}
{#                    <i class="Hui-iconfont">&#xe6df;</i> 编辑#}
{#                  </a>#}
{#                </td>#}
{#              </tr>#}
{#            {% endfor %}#}

          {% for asset in page_obj %}
                <tr>
                    <td><input type="checkbox" name="selected_assets" value="{{ asset.assetID }}"></td>
                    <td>{{ asset.assetID }}</td>
                    <td>{{ asset.assetName }}</td>
                    <td>{{ asset.assetOwner }}</td>
                    <td>{{ asset.description }}</td>
                    <td>{{ asset.assetFormat }}</td>
                    <td>{{ asset.get_assetLevel_display }}</td>
{#                    <td>{{ asset.get_status_display }}</td>#}
{#                    <td>#}
{#                        {% if asset.status == 'started' %}#}
{#                            {{ asset.assetPath }}#}
{#                        {% else %}#}
{#                            未开始#}
{#                        {% endif %}#}
{#                    </td>#}
                    <td>
                        <a href="javascript:;" onclick="edit_dataasset('{{ asset.assetID }}')" class="btn btn-primary radius">
                            <i class="Hui-iconfont">&#xe6df;</i> 编辑
                        </a>
                    </td>
                </tr>
            {% endfor %}
          </tbody>
        </table>
                        <div class="cl pd-5 bg-1 bk-gray">
  <span class="l">
    <!-- 这里可以添加批量操作的按钮或其他内容 -->
  </span>
  <span class="r">
    <!-- 分页链接开始 -->
 <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1" class="btn btn-primary radius">&laquo; 首页</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-primary radius">上一页</a>
        {% endif %}

        <span class="current">
            第 {{ page_obj.number }} 页 / 共 {{ page_obj.paginator.num_pages }} 页
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="btn btn-primary radius">下一页</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="btn btn-primary radius">末页 &raquo;</a>
        {% endif %}
    </span>
</div>
    <!-- 分页链接结束 -->
  </span>
</div>
      </div>
    </div>
  </div>
{#<div class="pagination">#}
{#    <span class="step-links">#}
{#        {% if data_assets_page.has_previous %}#}
{#            <a href="?page=1">&laquo; 首页</a>#}
{#            <a href="?page={{ data_assets_page.previous_page_number }}">上一页</a>#}
{#        {% endif %}#}
{##}
{#        <span class="current">#}
{#            第 {{ data_assets_page.number }} 页，共 {{ data_assets_page.paginator.num_pages }} 页。#}
{#        </span>#}
{##}
{#        {% if data_assets_page.has_next %}#}
{#            <a href="?page={{ data_assets_page.next_page_number }}">下一页</a>#}
{#            <a href="?page={{ data_assets_page.paginator.num_pages }}">尾页 &raquo;</a>#}
{#        {% endif %}#}
{#    </span>#}
{#</div>#}
</article>
		</div>
	</section>

<script type="text/javascript" src="/static/lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="/static/lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="/static/static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="/static/static/h-ui.admin.pro/js/h-ui.admin.pro.min.js"></script>
	<!--/_footer /作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="/static/lib/datatables/1.10.15/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="/static/lib/laypage/1.2/laypage.js"></script>
	<script type="text/javascript" src="/static/static/business/js/main.js"></script>
	<script type="text/javascript">

        // 添加数据资产的函数
        function add_dataasset() {
            window.location.href = "/data_asset_add/";  // 跳转到添加数据资产页面
        }
        function edit_dataasset(asset_id) {
        window.location.href = "/data_asset_edit/" + asset_id + "/";
    }
// 新增获取CSRF Token的函数
// 确保以下函数存在于全局作用域（在调用 batch_delete() 之前定义）
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
{#function batch_delete() {#}
{#    const csrftoken = getCookie('csrftoken');#}
{#    console.log('CSRF Token:', csrftoken); // 调试输出，检查控制台是否打印了令牌#}
{##}
{#    const selected_assets = $("input[name='selected_assets']:checked").map(function() {#}
{#        return $(this).val();#}
{#    }).get();#}
{##}
{#    console.log('Selected IDs:', selected_assets); // 检查是否选中了数据#}
{##}
{#    if (selected_assets.length === 0) {#}
{#        alert("请选择要删除的数据资产！");#}
{#        return;#}
{#    }#}
{##}
{#    if (confirm("确认删除选中的数据资产吗？")) {#}
{#        $.ajax({#}
{#            url: "/batch-delete-data-asset/",#}
{#            type: "POST",#}
{#            traditional: true,#}
{#            headers: {#}
{#                "X-CSRFToken": csrftoken // 确保请求头名称正确#}
{#            },#}
{#            data: {#}
{#                'selected_assets': selected_assets#}
{#            },#}
{#            success: function(res) {#}
{#                console.log('Response:', res); // 检查响应内容#}
{#                if (res.status === "success") {#}
{#                    location.reload();#}
{#                } else {#}
{#                    alert("删除失败：" + (res.message || '未知错误'));#}
{#                }#}
{#            },#}
{#            error: function(xhr) {#}
{#                console.error('Error:', xhr); // 输出完整错误信息#}
{#                alert(`请求失败：${xhr.statusText} (${xhr.status})`);#}
{#            }#}
{#        });#}
{#    }#}

function batch_delete() {
    const csrftoken = getCookie('csrftoken');
    const selected_assets = $("input[name='selected_assets']:checked").map(function() {
        return $(this).val();
    }).get();

    if (selected_assets.length === 0) {
        alert("请选择要删除的数据资产！");
        return;
    }

    if (confirm("确认删除选中的数据资产吗？此操作会生成存证记录！")) {  // 修改提示语
        $.ajax({
            url: "/batch-delete-data-asset/",
            type: "POST",
            traditional: true,
            headers: { "X-CSRFToken": csrftoken },
            data: { 'selected_assets': selected_assets },
            success: function(res) {
                if (res.status === "success") {
                    alert("删除成功，已生成存证记录！");  // 新增提示
                    location.reload();
                } else {
                    alert("删除失败：" + (res.message || '未知错误'));
                }
            },
            error: function(xhr) {
                alert(`请求失败：${xhr.statusText} (${xhr.status})`);
            }
        });
    }
}
    </script>
</body>
</html>